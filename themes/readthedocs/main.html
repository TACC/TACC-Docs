{# https://github.com/mkdocs/mkdocs/blob/1.4.2/mkdocs/themes/readthedocs/base.html #}
{# All changes must start and end with comments " TACC: " and " /TACC " #}
{%- extends "base.html" %}

  {%- block styles %}
    {# TACC: #}{# To load ReadTheDocs such that Core-Styles takes precedence #}
    <style>
      /* Layers not used in this block are used in later stylesheets */
      @layer foundation.mkdocs, foundation.tacc, base, project;

      /* Import ReadTheDocs styles but in a bottom layer */
      @import url("{{ 'css/theme.css'|url }}") layer(foundation.mkdocs);
      @import url("{{ 'css/theme_extra.css'|url }}") layer(foundation.mkdocs);

      /* Undo ReadTheDocs styles for page content */
      @layer foundation.tacc {
        .rst-content :not(img) {
          all: revert;
        }
      }
    </style>
    {# /TACC #}
    {%- if config.theme.highlightjs %}
      {# TACC: #}{# To load newest HighligtJS, different theme, in layer #}
      {# <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" /> #}
      <style>
        @import url("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/a11y-light.min.css") layer(foundation);
      </style>
      {# /TACC #}
    {%- endif %}
    {%- for path in extra_css %}
      <link href="{{ path }}" rel="stylesheet" />
    {%- endfor %}
  {%- endblock %}

  {%- block libs %}
    {% if page %}
      <script>
        // Current page data
        var mkdocs_page_name = {{ page.title|tojson }};
        var mkdocs_page_input_path = {{ page.file.src_path|string|tojson }};
        var mkdocs_page_url = {{ page.abs_url|tojson }};
      </script>
    {% endif %}
    <script src="{{ 'js/jquery-3.6.0.min.js'|url }}" defer></script>
    <!--[if lt IE 9]>
      <script src="{{ 'js/html5shiv.min.js'|url }}"></script>
    <![endif]-->
    {# TACC: #}{# To load newest HighlightJS, reduce footprint, add aliases #}
    {%- if config.theme.highlightjs %}
    <script type="module">
      import hljs from 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/es/core.min.js';
      {%- for lang in config.theme.hljs_languages %}
      import {{lang}} from 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/es/languages/{{lang}}.min.js';
      {%- endfor %}
      {%- for lang in config.theme.hljs_languages %}
      hljs.registerLanguage('{{lang}}', {{lang}});
      {%- endfor %}
      {%- for alias in config.theme.hljs_aliases %}
      hljs.registerLanguage('{{alias.name}}', {{alias.lang}});
      {%- endfor %}
      hljs.configure({
        cssSelector: 'pre:is(.highlight, .codehilite) code'
      });
      hljs.highlightAll();
    </script>
    {%- endif %}
    {# /TACC #}
  {%- endblock %}

  {%- block extrahead %}
  {# TACC (replace img svg with inline svg): #}
    <script src="{{ 'js/svg-inject.min.js'|url }}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      SVGInject(document.querySelectorAll('img[src$=".svg"]'), {
        onAllFinish: function() {
          console.info('Image SVGs replaced with inline SVGs.');
        }
      });
    });
    </script>
  {# /TACC #}
  {% endblock %}

  {%- block site_name %}
    {{ super() }}
    <a href="{{ config.cms_url }}" class="cms-link">{{ config.cms_name }}</a>
  {%- endblock %}

  {%- block scripts %}
    <script>var base_url = '{{ base_url }}';</script>
    {# TACC: #}{# To remove `docutils` class from tables #}
    {# <script src="{{ 'js/theme_extra.js'|url }}" defer></script> #}
    {# /TACC #}
    <script src="{{ 'js/theme.js'|url }}" defer></script>
    {# TACC: #}{# To suggest extra JavaScript be imported as modules #}
    {#
    {%- for path in extra_javascript %}
      <script src="{{ path }}" defer></script>
    {%- endfor %}
    #}
    <script type="module">
      import findLinksAndSetTargets from '{{ "js/modules/setTargetForExternalLinks.js"|url }}';

      findLinksAndSetTargets();
    </script>
    <script type="module" src="{{ "js/modules/styleLinksOutsideMainContent.js"|url }}"></script>
    {# /TACC #}
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable({{ 'true' if config.theme.sticky_navigation else 'false' }});
        };
    </script>
  {%- endblock %}
